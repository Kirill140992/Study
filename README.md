Добавил свои задачи, когда только начинал изучать технологии.
Список задач:

Nginx:
1. Сделать страницу, связать с nginx, прописать себе в hosts домен. Nginx должен прослушивать порты 80 и 443 только на
этом домене.
2. Сделать permanent redirect на https: http://test.com/my.php -> https://test.com/my.php.
3. Создать приватный ключ в openssl, создать сертификат, подключить к https-конфигу.
4. Директивой map ограничить доступ к серверу только со своего офисного IP. По localhost - доступ закрыт, nginx не
прослушивает localhost

Nginx, 2 задание:
1. Настроить ограничение по количеству одновременных подключений к уже созданному в первом задании серверу со
своего IP, ограничение составляет 5 одновременных подключений. Проверить корректность настройки реальным
примером с помощью утилиты ab, указав в ее настройках, например 10 одновременных. Показать конфиг nginx, показать
лог сессии ab.

Работа с Redis и Haproxy
1. Установить из стандартных пакетов redis (redis-server).
2. Написать скрипт на bash для генерации файла с SET- командами redis. Задача состоит в том, чтобы залить в базу 1 млн
ключей вида key1:randomvalue, key2:randomvalue, key1000000:randomvalue, где randomvalue - 16-символьная ascii-
строка. Использовать /dev/urandom для генерации случайных строк.
3. Запустить второй экземпляр redis на своей машине, подключить его как slave к первому. Второй запускать с отдельным
конфигом на порту 6380. И первый, и второй не должны прослушивать все интерфейсы, только офисный адрес.
4. Установить haproxy. Настроить 1 фронтенд на localhost:6379, и два бекенда - на первый и второй redis. Для описания
логики выбора мастера использовать стандартную логику на наборе вопрос-ответ. Найти набор в гугле можно по первой
строке tcp-check send AUTH\ mypassword\r\n
5. Убедиться, что через redis-cli -h 127.0.0.1 -p 6379 доступ есть и это именно мастер
6. Выполнить залив данных из файла, подготовленного в п.1, через redis-cli --pipe. Почитать о смысле этого ключа.
Убедиться, что данные в полном объеме есть на slave.
7. По завершению задания показать конфиги redis master, redis slave, haproxy; показать генератор файла из п.1; показать
результат команды info для redis master и для redis slave


Ansible
С помощью ansible-galaxy требуется инициализировать новую роль. Конфигурационный файл, который вы писали ранее,
необходимо разместить в templates директорию роли. Написать плейбук, который установит nginx, скопирует требуемый
темплейт в nginx/sites-enabled и произведет nginx reload. По результатам представить доказательство успешного старта - system
ctl status nginx & nginx -t, а также сам плейбук.


PHP:
1.1. Установить из sury.org пакеты версии 7.4, в том числе добавить php7.4-*: bcmath, mysql, mbstring, xmlrpc, xml, zip, intl,
soap, curl, dev, fpm, cli. Выяснить для себя, для чего нужен каждый из пакетов.
2. Настроить fpm pool c именем app1 в динамическом режиме с максимальным количеством рабочих процессов - 20.
Показать получившийся конфиг.
3. Настроить fpm pool c именем app2 в статическом режиме с количеством рабочих процессов - 10.
4. Настроить в nginx прохождение запросов через location / на этот пул. В root dir создать index.php и добавить в него
вывод строки "app2". Убедиться, что при обращении через Nginx на / на экране видна эта строка.
5. Выяснить, как настроить хранилище сессионных данных в конфиге fpm pool. Настроить для этого конфига хранение в
redis.
6. Включить в конфиге pool возможность загрузки файлов на сервер, настроить максимальный размер файла на 20 Мб.
Обеспечить возможность отправки файла такого размера в fpm и через nginx, где также есть проверка на размер.
7. Показать получившиеся конфиги.


Mysql
1. Выяснить, каковы сейчас актуальные версии mysql, каковы ведущие поставщики решений есть и чем они в целом
отличаются.
2. Выяснить, что такое storage engine, чем отличается innodb от myisam, что рекомендуется применять в каких случаях.
3. Узнать о работе mysql replication в асинхронном режиме (стандартная репликация). Что она позволяет делать, как она
работает.
4. Выяснить, чем отличаются базы в режиме master/slave от режима master/master, познакомиться с Galera для Mysql.
Узнать о ее возможностях и ограничениях, подумать, почему для основных баз мы применяем это решение (Galera).


Mysql №2
Настроить у себя связку мастер-слейв в стандартном режиме. Для этого ты запускаешь первую базу на порту 3306, а вторую -
на порту 3307 с разными data-каталогами и конфигами, конечно. Затем ты изучаешь, как создать и добавить базе ключ и
сертификат для того, чтобы затем организовать защищенное ssl-соединение между мастером и слейвом.
Твоя конечная цель:
Запущены оба экземпляра базы, между ними установлена связь с использованием ssl. При этом используется специально
созданный пользователь с паролем исключительно с правами для репликации. При запуске команды show slave status мы
должны увидеть активное живое подключение.
Примечание: инстансы MySQL поднимать с использованием systemd.


Работа с ProxySQL
1. Установить ProxySQL последней стабильной версии.
2. Определить в нем 2 hostgroup, в каждой по одному "серверу" из предыдущего задания. Первая группа будет пишущей
(master), вторая - читающей (slave).
3. Определить в нем 2 пользователя, их же создать в в БД (на master, поскольку на slave они должны попасть
автоматически).
4. Обеспечить доступ для 1-го пользователя через 1-ю группу, для 2-го - через 2-ю группу.
5. Подключиться к ProxySQL сначала 1-м, потом 2-м пользователем. Убедиться, что ProxySQL отправляет запросы на
верные серверы бекенда (на master или на slave соответственно).
6. Установить ограничение в 1-й группе в 1 connection для бекенда. Одновременно подключиться 1-м пользователем из
двух консолей. Проверить и понять результат.
7. Выяснить, как работает передача конфигурационной информации из конфига в runtime-конфиг.
8. После этого подключиться к admin mysql interface самого ProxySQL и отключить (сделать неактивной) первую группу с
помощью запроса.
9. Проверить возможность подключения к базе (master) через ProxySQL после выполнения п.8
Для проверки: показать конфигурационный файл ProxySQL в его виде после выполнения задания 6, показать запрос из задания
8, а также запрос и вывод ответа из задания 9.
Работа с Prometheus и Grafana
1. Установить docker prometheus stack(alertmanager, grafana, prometheus) последней стабильной версии.
2. Установить и запустить node_expoter для мониторинга состояния компьютера.
3. Настроить мониторинг состояния Redis из задания "Работа с Redis и haproxy" (например, с использованием oliver006
/redis_exporter).
4. Установить blackbox_exporter, добавить несколько произвольных эндпоинтов для мониторинга.
5. Установить и запустить cadvisor для мониторинга docker.
6. Установить grafana и подключить к ней в качестве datasource prometheus.
7. Найти и импортировать dashboards из grafana.com для cadvisor, redis, blackbox и node экспортеров.
Для проверки: предоста
